<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìã Organisateur CV TAFINAR</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f7fa;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .main-content {
            padding: 30px;
        }

        .config-section {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            border-left: 4px solid #667eea;
        }

        .input-group {
            margin-bottom: 25px;
        }

        .input-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }

        .input-group input,
        .input-group select,
        .input-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e6ed;
            border-radius: 6px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .input-group input:focus,
        .input-group select:focus,
        .input-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .cv-input {
            min-height: 300px;
            resize: vertical;
            font-family: monospace;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            width: 100%;
            margin-bottom: 20px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: #667eea;
            font-weight: 600;
        }

        .loading::before {
            content: "‚è≥";
            margin-right: 10px;
            animation: spin 2s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .results {
            display: none;
            margin-top: 30px;
        }

        .section-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .section-block {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            border: 1px solid #e9ecef;
        }

        .section-title {
            background: #2c5aa0;
            color: white;
            padding: 10px 15px;
            margin: -20px -20px 15px -20px;
            border-radius: 8px 8px 0 0;
            font-weight: 600;
            font-size: 1.1em;
        }

        .section-content {
            width: 100%;
            min-height: 150px;
            border: 2px solid #e0e6ed;
            border-radius: 6px;
            padding: 12px;
            font-family: inherit;
            font-size: 14px;
            line-height: 1.5;
            resize: vertical;
        }

        .section-content:focus {
            outline: none;
            border-color: #2c5aa0;
            box-shadow: 0 0 0 3px rgba(44, 90, 160, 0.1);
        }

        .instructions {
            background: #e7f3ff;
            border: 1px solid #b3d9ff;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .instructions h3 {
            color: #0066cc;
            margin-bottom: 15px;
        }

        .instructions ol {
            padding-left: 20px;
        }

        .instructions li {
            margin-bottom: 8px;
        }

        .error {
            background: #fee;
            border: 1px solid #fcc;
            color: #c33;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            display: none;
        }

        .success {
            background: #efe;
            border: 1px solid #cfc;
            color: #363;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìã Organisateur CV TAFINAR</h1>
            <p>Structurez automatiquement vos CV avec l'IA</p>
        </div>

        <div class="main-content">
            <div class="instructions">
                <h3>üí° Mode d'emploi :</h3>
                <ol>
                    <li><strong>Configurez</strong> votre cl√© API OpenRouter ci-dessous</li>
                    <li><strong>Collez</strong> le CV en vrac dans la zone de texte</li>
                    <li><strong>Cliquez</strong> "Organiser" - l'IA structure automatiquement</li>
                    <li><strong>Modifiez</strong> chaque section si n√©cessaire dans les zones s√©par√©es</li>
                    <li><strong>Utilisez</strong> le r√©sultat pour votre mise en page finale</li>
                </ol>
            </div>

            <div class="config-section">
                <h3>‚öôÔ∏è Configuration API</h3>
                <div class="input-group">
                    <label for="api-key">Cl√© API OpenRouter :</label>
                    <input type="password" 
                           id="api-key" 
                           placeholder="sk-or-v1-xxxxx..."
                           value="">
                    <small style="color: #666;">Obtenez votre cl√© sur <a href="https://openrouter.ai" target="_blank">OpenRouter.ai</a></small>
                </div>

                <div class="input-group">
                    <label for="model-select">Mod√®le IA :</label>
                    <select id="model-select">
                        <option value="meta-llama/llama-3.1-70b-instruct:free">Llama 3.1 70B (Gratuit)</option>
                        <option value="openai/gpt-4o-mini">GPT-4o Mini (Payant)</option>
                        <option value="anthropic/claude-3.5-sonnet">Claude 3.5 Sonnet (Payant)</option>
                    </select>
                </div>
            </div>

            <div class="error" id="error-message"></div>
            <div class="success" id="success-message"></div>

            <form id="cv-form">
                <div class="input-group">
                    <label for="cv-input">CV en vrac :</label>
                    <textarea id="cv-input" 
                              class="cv-input"
                              placeholder="Collez ici le CV complet en vrac...

Exemple:
Jean Dupont
jean.dupont@email.com
06 12 34 56 78
123 rue de la Paix, Paris

EXPERIENCE PROFESSIONNELLE
D√©veloppeur Senior - TechCorp (2020-2024)
D√©veloppement d'applications web
Management d'√©quipe

COMPETENCES
JavaScript, Python, React
Management, Leadership

FORMATION
Master Informatique - Universit√© Paris (2018)
Licence Informatique - Universit√© Lyon (2016)

LANGUES
Fran√ßais (natif), Anglais (courant)

CENTRES D'INTERET
Programmation, Voyages, Sport"
                              required></textarea>
                </div>

                <button type="submit" class="btn" id="organize-btn">
                    ü§ñ Organiser avec l'IA
                </button>
            </form>

            <div class="loading" id="loading">
                Analyse et organisation en cours...
            </div>

            <div class="results" id="results">
                <h2 style="margin-bottom: 20px; color: #333;">üìù CV Organis√© par sections :</h2>
                
                <div class="section-grid">
                    <div class="section-block">
                        <div class="section-title">üíº Exp√©riences Professionnelles</div>
                        <textarea class="section-content" id="experiences" placeholder="Les exp√©riences appara√Ætront ici..."></textarea>
                    </div>

                    <div class="section-block">
                        <div class="section-title">üéØ Comp√©tences</div>
                        <textarea class="section-content" id="competences" placeholder="Les comp√©tences appara√Ætront ici..."></textarea>
                    </div>

                    <div class="section-block">
                        <div class="section-title">üéì Formations</div>
                        <textarea class="section-content" id="formations" placeholder="Les formations appara√Ætront ici..."></textarea>
                    </div>

                    <div class="section-block">
                        <div class="section-title">üåç Langues</div>
                        <textarea class="section-content" id="langues" placeholder="Les langues appara√Ætront ici..."></textarea>
                    </div>

                    <div class="section-block">
                        <div class="section-title">üé® Centres d'Int√©r√™t</div>
                        <textarea class="section-content" id="centres_interet" placeholder="Les centres d'int√©r√™t appara√Ætront ici..."></textarea>
                    </div>

                    <div class="section-block">
                        <div class="section-title">‚ûï Section Libre</div>
                        <textarea class="section-content" id="section_libre" placeholder="Zone libre pour ajouts manuels..."></textarea>
                    </div>
                </div>

                <div style="margin-top: 30px; text-align: center;">
                    <button type="button" class="btn" onclick="clearAll()" style="width: auto; margin: 0 10px;">
                        üÜï Nouveau CV
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Sauvegarde automatique de la configuration
        document.getElementById('api-key').addEventListener('input', function() {
            localStorage.setItem('openrouter_api_key', this.value);
        });

        document.getElementById('model-select').addEventListener('change', function() {
            localStorage.setItem('openrouter_model', this.value);
        });

        // Chargement de la configuration sauvegard√©e
        window.addEventListener('load', function() {
            const savedApiKey = localStorage.getItem('openrouter_api_key');
            const savedModel = localStorage.getItem('openrouter_model');
            
            if (savedApiKey) {
                document.getElementById('api-key').value = savedApiKey;
            }
            if (savedModel) {
                document.getElementById('model-select').value = savedModel;
            }
        });

        // Gestion du formulaire
        document.getElementById('cv-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const apiKey = document.getElementById('api-key').value.trim();
            const model = document.getElementById('model-select').value;
            const cvText = document.getElementById('cv-input').value.trim();
            
            // Validation
            if (!apiKey) {
                showError('Veuillez entrer votre cl√© API OpenRouter');
                return;
            }
            
            if (!cvText) {
                showError('Veuillez coller le CV √† organiser');
                return;
            }
            
            // Interface de chargement
            document.getElementById('organize-btn').disabled = true;
            document.getElementById('loading').style.display = 'block';
            hideMessages();
            
            try {
                const result = await organizeCV(apiKey, model, cvText);
                displayResults(result);
                showSuccess('CV organis√© avec succ√®s !');
            } catch (error) {
                showError('Erreur: ' + error.message);
            } finally {
                document.getElementById('organize-btn').disabled = false;
                document.getElementById('loading').style.display = 'none';
            }
        });

        async function organizeCV(apiKey, model, cvText) {
            const prompt = `Tu es un organisateur de CV professionnel. Analyse ce CV et s√©pare-le EXACTEMENT par sections.

CV EN VRAC:
${cvText}

R√àGLES ABSOLUES:
1. Ne JAMAIS modifier, reformuler ou changer le texte original
2. COPIE exactement chaque phrase dans la bonne section  
3. SUPPRIME seulement: nom complet, pr√©nom, email, t√©l√©phone, adresse compl√®te
4. ORDRE OBLIGATOIRE: Exp√©riences ‚Üí Comp√©tences ‚Üí Formations ‚Üí Langues ‚Üí Centres d'int√©r√™t
5. Une phrase = une ligne (retour √† la ligne apr√®s chaque phrase)
6. Garde TOUT le contenu professionnel intact

R√âPONDS UNIQUEMENT en JSON valide (sans commentaires):
{
  "experiences": "texte exact des exp√©riences...",
  "competences": "texte exact des comp√©tences...",
  "formations": "texte exact des formations...",
  "langues": "texte exact des langues...",
  "centres_interet": "texte exact des centres d'int√©r√™t..."
}`;

            const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${apiKey}`,
                    'Content-Type': 'application/json',
                    'HTTP-Referer': window.location.href,
                    'X-Title': 'CV Organizer TAFINAR'
                },
                body: JSON.stringify({
                    model: model,
                    messages: [
                        {
                            role: 'user',
                            content: prompt
                        }
                    ],
                    temperature: 0.1,
                    max_tokens: 2000
                })
            });

            if (!response.ok) {
                const errorData = await response.json().catch(() => ({}));
                throw new Error(errorData.error?.message || `HTTP ${response.status}`);
            }

            const data = await response.json();
            const content = data.choices?.[0]?.message?.content;
            
            if (!content) {
                throw new Error('R√©ponse vide de l\'IA');
            }

            // Parse du JSON de l'IA
            try {
                const jsonMatch = content.match(/\{[\s\S]*\}/);
                if (jsonMatch) {
                    return JSON.parse(jsonMatch[0]);
                } else {
                    throw new Error('Format JSON non trouv√© dans la r√©ponse');
                }
            } catch (parseError) {
                console.log('Contenu brut re√ßu:', content);
                throw new Error('Format de r√©ponse invalide: ' + parseError.message);
            }
        }

        function displayResults(data) {
            // Affichage des r√©sultats dans les zones
            document.getElementById('experiences').value = data.experiences || '';
            document.getElementById('competences').value = data.competences || '';
            document.getElementById('formations').value = data.formations || '';
            document.getElementById('langues').value = data.langues || '';
            document.getElementById('centres_interet').value = data.centres_interet || '';
            
            // Afficher la section r√©sultats
            document.getElementById('results').style.display = 'block';
            
            // Scroll vers les r√©sultats
            document.getElementById('results').scrollIntoView({ 
                behavior: 'smooth',
                block: 'start'
            });
        }

        function showError(message) {
            const errorDiv = document.getElementById('error-message');
            errorDiv.textContent = '‚ùå ' + message;
            errorDiv.style.display = 'block';
        }

        function showSuccess(message) {
            const successDiv = document.getElementById('success-message');
            successDiv.textContent = '‚úÖ ' + message;
            successDiv.style.display = 'block';
        }

        function hideMessages() {
            document.getElementById('error-message').style.display = 'none';
            document.getElementById('success-message').style.display = 'none';
        }

        function clearAll() {
            if (confirm('Effacer tout et recommencer ?')) {
                document.getElementById('cv-input').value = '';
                document.getElementById('results').style.display = 'none';
                document.querySelectorAll('.section-content').forEach(textarea => {
                    textarea.value = '';
                });
                hideMessages();
                document.getElementById('cv-input').focus();
            }
        }
    </script>
</body>
</html>
